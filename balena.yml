type: type-product-os-t-type-source@1.0.3
name: Service source
version: 2.0.0
data:
  $transformer: {}
  schema:
      type: object
      required: ['data']
      properties:
        data:
          type: object
          properties:
            $transformer:
              type: object
              properties:
                mergeable:
                  description: PRs to instances of this type can be merged IF...
                  type: boolean
                  readOnly: true
                  default: false
                  $$formula: |-
                  EVERY(VALUES(contract.data.platforms), "image") &&
                  contract.data.$transformer.backflow &&
                  contract.data.$transformer.backflow.filter(
                    function(b){
                      return b &&
                              b.type.startsWith("t-product-os-test-run") &&
                              b.data.data.success
                    }
                  ).length > 0
